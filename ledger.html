<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Donations Ledger • BirdID</title>
<link rel="stylesheet" href="style.css">
<style>
  .card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.08);max-width:720px;margin:20px auto}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #e6e6e6;text-align:left}
  th{background:#f6f7fb}
  .muted{color:#666}
</style>
</head>
<body>
  <div class="card">
    <h1>Public Donations Ledger</h1>
    <p class="muted">We publish Pi tips pledged for bird conservation. (Test ledger; will list first beneficiary after KYB.)</p>
    <div id="status" class="muted">Loading…</div>
    <table id="tbl" style="display:none">
      <thead><tr><th>Date</th><th>TxID</th><th>Amount (Pi)</th><th>Beneficiary</th><th>Note</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
    <p class="muted">
      Raw files: <a href="/ledger/donations.json">JSON</a> • <a href="/ledger/donations.csv">CSV</a>
    </p>
    <p><a class="btn-home" href="/index.html">Back to Home</a></p>
  </div>
<script>
(async function(){
  const status = document.getElementById('status');
  const tbl = document.getElementById('tbl');
  const rows = document.getElementById('rows');
  try {
    const res = await fetch('/ledger/donations.json?v=' + Date.now(), {cache:'no-store'});
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    if (!Array.isArray(data) || data.length === 0) {
      status.textContent = 'No donations yet — check back soon.';
      return;
    }
    status.style.display = 'none';
    tbl.style.display = '';
    data.forEach(rec => {
      const tr = document.createElement('tr');
      const td = (t)=>{const d=document.createElement('td'); d.textContent=t||''; return d;};
      tr.append(td(rec.date), td(rec.txid), td(rec.amount_pi), td(rec.beneficiary), td(rec.note));
      rows.appendChild(tr);
    });
  } catch (e) {
    status.textContent = 'Ledger not available yet.';
  }
})();
</script>
</body>
</html>
